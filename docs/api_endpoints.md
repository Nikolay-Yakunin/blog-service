# API эндпоинты

## Пользователи (`/users`)

### GET `/users/:id`

**Что ожидает:**

- Параметр пути: `id` (uint)

**Что возвращает:**

- 200: JSON с данными пользователя
- 400: Неверный формат ID
- 404: Пользователь не найден

---

### GET `/users/me`

**Что ожидает:**

- JWT авторизация (middleware)

**Что возвращает:**

- 200: JSON с данными текущего пользователя
- 401: Не авторизован
- 404: Пользователь не найден

---

### PUT `/users/me`

**Что ожидает:**

- JWT авторизация
- JSON: `{ "username": string, "bio": string }`

**Что возвращает:**

- 200: Обновленный пользователь
- 400: Неверный формат данных или имя занято
- 401: Не авторизован
- 404: Пользователь не найден

---

### GET `/users/admin` (только для админов)

**Что ожидает:**

- JWT авторизация, роль admin
- Query: `role` (опционально), `active` (опционально)

**Что возвращает:**

- 200: Список пользователей по фильтру
- 400: Нет фильтра

---

### PUT `/users/admin/:id/verify` (только для админов)

**Что ожидает:**

- JWT авторизация, роль admin
- Параметр пути: `id`

**Что возвращает:**

- 200: Статус верификации
- 404: Пользователь не найден

---

### PUT `/users/admin/:id/role` (только для админов)

**Что ожидает:**

- JWT авторизация, роль admin
- Параметр пути: `id`
- JSON: `{ "role": string }`

**Что возвращает:**

- 200: Обновленный пользователь
- 400: Неверный формат данных или недопустимая роль
- 404: Пользователь не найден

---

### PUT `/users/admin/:id/deactivate` (только для админов)

**Что ожидает:**

- JWT авторизация, роль admin
- Параметр пути: `id`

**Что возвращает:**

- 200: Статус деактивации
- 404: Пользователь не найден

---

## Посты (`/api/v1/posts`)

### GET `/api/v1/posts`

**Что ожидает:**

- Query: `offset`, `limit` (опционально)

**Что возвращает:**

- 200: Список постов (массив объектов Post)

**Пример ответа:**

```json
[
  {
    "id": 1,
    "title": "Как настроить Swagger в Go",
    "slug": "how-to-setup-swagger-in-go",
    "description": "Подробное руководство по настройке документации API с помощью Swagger в Go-приложениях",
    "raw_content": "# Заголовок\n\nМаркдаун контент поста...",
    "html_content": "<h1>Заголовок</h1><p>HTML контент поста...</p>",
    "status": "published",
    "tags": ["golang", "swagger", "api"],
    "view_count": 42,
    "created_at": "2025-01-01T00:00:00Z",
    "updated_at": "2025-01-02T00:00:00Z",
    "published_at": "2025-01-03T12:00:00Z",
    "author_id": 5,
    "comments": []
  }
]
```

- 500: Ошибка сервера

---

### GET `/api/v1/posts/:id`

**Что ожидает:**

- Параметр пути: `id`

**Что возвращает:**

- 200: Данные поста (объект Post)
- 404: Пост не найден
- 500: Ошибка сервера

**Пример ответа:**

```json
{
  "id": 1,
  "title": "Как настроить Swagger в Go",
  "slug": "how-to-setup-swagger-in-go",
  "description": "Подробное руководство по настройке документации API с помощью Swagger в Go-приложениях",
  "raw_content": "# Заголовок\n\nМаркдаун контент поста...",
  "html_content": "<h1>Заголовок</h1><p>HTML контент поста...</p>",
  "status": "published",
  "tags": ["golang", "swagger", "api"],
  "view_count": 42,
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-02T00:00:00Z",
  "published_at": "2025-01-03T12:00:00Z",
  "author_id": 5,
  "comments": []
}
```

**Пример ошибки:**

```json
{
  "error": "Post not found"
}
```

---

### GET `/api/v1/posts/slug/:slug`

**Что ожидает:**

- Параметр пути: `slug`

**Что возвращает:**

- 200: Данные поста (объект Post)
- 404: Пост не найден

**Пример ответа:**
(см. выше)

---

### POST `/api/v1/posts` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- JSON: данные поста

**Пример запроса:**

```json
{
  "title": "Как настроить Swagger в Go",
  "slug": "how-to-setup-swagger-in-go",
  "description": "Подробное руководство по настройке документации API с помощью Swagger в Go-приложениях",
  "raw_content": "# Заголовок\n\nМаркдаун контент поста...",
  "html_content": "<h1>Заголовок</h1><p>HTML контент поста...</p>",
  "status": "published",
  "tags": ["golang", "swagger", "api"]
}
```

**Что возвращает:**

- 201: Созданный пост (объект Post)
- 400: Неверные данные
- 401: Не авторизован

**Пример ответа:**
(см. выше)

---

### PUT `/api/v1/posts/:id` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- Параметр пути: `id`
- JSON: данные поста (аналогично POST)

**Пример запроса:**

```json
{
  "title": "Обновленный заголовок",
  "slug": "updated-slug",
  "description": "Обновленное описание",
  "raw_content": "# Новый контент",
  "html_content": "<h1>Новый контент</h1>",
  "status": "draft",
  "tags": ["go", "api"]
}
```

**Что возвращает:**

- 200: Обновленный пост (объект Post)
- 400: Неверные данные
- 401: Не авторизован
- 404: Пост не найден

**Пример ответа:**
(см. выше)

---

### DELETE `/api/v1/posts/:id` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- Параметр пути: `id`

**Что возвращает:**

- 204: Успешно удалено (без тела)
- 400: Неверный ID
- 401: Не авторизован
- 404: Пост не найден

**Пример ошибки:**

```json
{
  "error": "Post not found"
}
```

---

## Комментарии (`/api/v1/comments`)

### GET `/api/v1/comments?postId=...` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- Query: `postId` (обязателен)

**Что возвращает:**

- 200: Список комментариев (древовидно)
- 400: Нет postId или неверный формат
- 500: Ошибка сервера

---

### POST `/api/v1/comments` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- JSON: `{ "content": string, "post_id": uint, "parent_id": uint (опционально) }`

**Что возвращает:**

- 201: Созданный комментарий
- 400: Неверные данные
- 500: Ошибка сервера

---

### PUT `/api/v1/comments/:id` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- Параметр пути: `id`
- JSON: обновленные данные комментария

**Что возвращает:**

- 200: Обновленный комментарий
- 400: Неверные данные
- 403: Нет прав
- 500: Ошибка сервера

---

### DELETE `/api/v1/comments/:id` (требует авторизации)

**Что ожидает:**

- JWT авторизация
- Параметр пути: `id`

**Что возвращает:**

- 204: Успешно удалено
- 400: Неверный ID
- 403: Нет прав
- 500: Ошибка сервера

---

## Аутентификация (`/auth`)

### GET `/auth/login/:provider`

**Что ожидает:**

- Параметр пути: `provider` (github, google, vk)

**Что возвращает:**

- 302: Редирект на страницу авторизации провайдера
- 400: Неподдерживаемый провайдер

---

### GET `/auth/callback/:provider`

**Что ожидает:**

- Параметр пути: `provider`
- Query: `code` (от OAuth)

**Что возвращает:**

- 302: Редирект на клиент с параметрами пользователя и токеном
- 500: Ошибка сервера

---

### POST `/auth/logout`

**Что ожидает:**

- JWT авторизация (в заголовке Authorization)

**Что возвращает:**

- 200: Статус выхода
- 400: Токен не предоставлен
- 401: Недействительный токен
- 500: Ошибка сервера
