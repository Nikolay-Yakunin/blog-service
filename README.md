# Blog Service
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

## Цель проекта
Создать масштабируемый и модульный блог-сервис, обеспечивающий:

- Редактирование и форматирование контента с помощью Markdown.
- Интерактивность постов с возможностью голосования и оценки.
- Надёжную аутентификацию через популярные OAuth-провайдеры.
- Управление комментариями с иерархической структурой.
- Дополнительные функции, такие как поиск, уведомления и административная панель.
- Лёгкую контейнеризацию, автоматизированную сборку и мониторинг.

# Предметная область
Личный блог, посты сахраняемые в формате md, средства аутентификации с помощью провайдеров, комментарии, быстрый поиск по постам (названиям, контенту постов, комментариям, веткам комментариев), уведомления и админ панель с метриками, аналитикой и инструментами модерации, администрирования.

# Бизнес процессы
- Посты
    - Создание, редактирование, удаление, теги, отложеная публикация, счетчик просмотров, оценка, интерактивности (голосование или сбор обратной связи)
- Пользователи
    - ... , аутентификация через провайдера, редактирование информации профиля, верификация для повышения доступа (не верефицированные пользователи, могут только просматривать посты)
- Комментарии
    - ... , ответ на комментарий (ветвление, thread), верификация доступа, цензура по черному списку (слова с которыми комментарий не может быть создан, например "***")
- Быстрый поиск
    - ... , поиск по тегам, поиск по заголовкам, поиск по контенту, поиск по верхнему уровню комментариев, поиск по веткам комментариев
- Уведомления
    - ... , уведомления и оповещения внутри сервиса (я хочу купить домен, но у меня денег нет, а stmp не зарегать без домена)
- Метрики и аналитика
    - ... , анализ посещаемости, просмотров, удержания на посте (авторизованных, неавторизованных, верифицированных пользователей), количества аутентификаций (по провайдерам), количества новых пользователей (авторизованных), количества комментариев (для верифицированных пользователей)

## Сборка
- Склонируйте репозиторий
по *http*
```
git clone https://gitlab.com/Nikolay-Yakunin/blog-service.git
```
или по *ssh*
```
git clone git@gitlab.com:Nikolay-Yakunin/blog-service.git
```

PS: для генерации ключа
```
ssh-keygen -t rsa
cat (имя файла с ключем | по дефолту /root/.ssh/id_rsa)
```
Скопируйте оутпут и добавьте в свой профиль Gitlab/Github

# Requerments
Перед началом сборки проекта, убедитесь, что у вас присутствуют все необходимые зависимости

- **Go**: 1.24.1
- **Make**: для локальной сборки проекта
- **Docker** and **Docker-compose**: для сборки контейнера
- **Postgress**: 16.2 база данных

# Сборка с помощью Make
```
make
```
На выходе у вас будет исполняемый файл с именем **main** или **main.exe**, в зависимости от платформы

## Структура проекта

```
.
├── cmd/
│   └── app/                 # Точка входа приложения
├── config/                  # Конфигурационные файлы
├── internal/
│   ├── posts/               # Управление постами
│   ├── users/               # Управление пользователями
│   ├── auth/                # Аутентификация через OAuth
│   ├── comments/            # Система комментариев
│   ├── search/              # Поисковый движок
│   ├── notifications/       # Система уведомлений
│   ├── admin/               # Административная панель
│   └── metrics/             # Сбор и анализ метрик
├── pkg/
│   ├── database/            # Работа с БД
│   ├── middleware/          # Промежуточные обработчики
│   ├── validator/           # Валидация данных
│   └── utils/               # Общие утилиты
├── migrations/              # SQL миграции
├── docs/                    # Документация API
└── deployments/             # Конфигурации развертывания
    ├── docker/
    └── kubernetes/          # Возможно
```

## OAuth Configuration

Для работы OAuth аутентификации необходимо создать приложения у провайдеров и настроить переменные окружения:

### GitHub OAuth
```bash
OAUTH_GITHUB_CLIENT_ID=your_client_id
OAUTH_GITHUB_CLIENT_SECRET=your_client_secret
OAUTH_GITHUB_REDIRECT_URL=http://localhost:8080/auth/github/callback
```

### Google OAuth
```bash
OAUTH_GOOGLE_CLIENT_ID=your_client_id
OAUTH_GOOGLE_CLIENT_SECRET=your_client_secret
OAUTH_GOOGLE_REDIRECT_URL=http://localhost:8080/auth/google/callback
```

### VK OAuth
```bash
OAUTH_VK_CLIENT_ID=your_client_id
OAUTH_VK_CLIENT_SECRET=your_client_secret
OAUTH_VK_REDIRECT_URL=http://localhost:8080/auth/vk/callback
```

## Компоненты инфраструктуры

- **PostgreSQL**: Основное хранилище данных
- **Redis**: Кеширование и сессии
- **Elasticsearch**: Поисковый движок
- **Prometheus + Grafana**: Мониторинг и визуализация метрик
- **Docker**: Контейнеризация
- **Nginx**: Обратный прокси-сервер

## Команды Makefile

- **make build**: Сборка приложения.
- **make test**: Запуск тестов с генерацией отчёта покрытия.
- **make docker-up**: Запуск приложения через docker-compose. (Пока не актуально)
- **make clean**: Очистка сгенерированных файлов.

## Развертывание с Docker

1. Сборка и запуск всех сервисов:
```bash
docker-compose up -d
```

2. Проверка статуса:
```bash
docker-compose ps
```

3. Просмотр логов:
```bash
docker-compose logs -f app
```

4. Остановка:
```bash
docker-compose down
```

Сервисы будут доступны по следующим портам:
- Blog API: http://localhost:8080
- Grafana: http://localhost:3000
